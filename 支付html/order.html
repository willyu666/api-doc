<!doctype html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>接口规则</title>
	<link rel="stylesheet" type="text/css" href="css/normalize.css" />
	<link rel="stylesheet" type="text/css" href="css/default.css">
	<link href='http://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="css/styles.css">
</head>
 <style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;}
.tg .tg-tmsl{background-color:#ffffff;border-color:#c0c0c0;text-align:left}
.tg .tg-krjj{font-weight:bold;background-color:#efefef;border-color:#c0c0c0;text-align:left}
.tg .tg-u4qj{background-color:#efefef;border-color:#c0c0c0;text-align:left;vertical-align:top}
.tg .tg-855q{background-color:#ffffff;border-color:#c0c0c0;text-align:left;vertical-align:top}
.tg .tg-xggu{background-color:#efefef;border-color:#c0c0c0;text-align:left}
.tg .tg-wo29{border-color:#c0c0c0;text-align:left;vertical-align:top}
</style>
<body>
	<nav>
	  <ul>
	   <a href="./index.html"> <li>Iotpay接入说明</li></a>	  	    
	    <a href="./codeid.html"><li>编码表</li></a>
		<a href="./interfacerule.html"><li>接口规则</li></a>
		<a href="./order.html"> <li>统一下单</li></a>
		<a href="./orderquery.html"><li>订单查询</li></a>
		<a href="./payresult.html"><li>支付结果通知</li></a>
		<a href="./errorcode.html"><li>全局错误代码</li></a>
		<li>下载</li>
	  </ul>
	</nav>
	<div class="openNav">
	  <div class="icon"></div>
	</div>

	<div class="wrapper">
		<header class="htmleaf-header">
			<h1>统一下单<span>order</span></h1>
			<div class="htmleaf-links">
				<a class="htmleaf-icon icon-htmleaf-home-outline" href="http://www.iotpay.ca" title="Iotpay" target="_blank"><span> Iotpay.ca</span></a>
				<a class="htmleaf-icon icon-htmleaf-arrow-forward-outline" href="./index.html" title="Iotpay接入说明" target="_blank"><span> Iotpay接入说明</span></a>
			</div>
		</header>
	  <section>
	<div class="doc-title-box">
			<h2 style="font-weight: bold;">统一下单</h2>
		</div>
     <p>业务通过统一下单接口可以发起任意三方支付渠道的支付订单。业务系统不必关心该如何调用三方支付，统一下单接口会根据业务系统选择的支付渠道ID，选择对应支付渠道的支付产品，发起下单请求，然后响应给业务系统支付请求所需参数。</p>
	 <p><img src="./imgs/process.png" alt="流程图" style="width:900px;height:700px;"></p>
	 <div class="doc-title-box">
			<h2 style="font-weight: bold;">请求URL</h2>
	 </div>
		<p>服务地址: <pre>https://pay.4jicao.com/api/pay/create_order</pre></p>
		<p>请求方式：</p>
		<p>◆ POST</p>
		<p>◆ Content-Type: application/x-www-form-urlencoded</p>
	 <div class="doc-title-box">
			<h2 style="font-weight: bold;">参数</h2>
	 </div>	
			
		<table class="tg">
		  <tr>
			<th class="tg-krjj">字段名</th>
			<th class="tg-krjj">变量名</th>
			<th class="tg-krjj">必填</th>
			<th class="tg-krjj">类型</th>
			<th class="tg-u4qj">示例值</th>
			<th class="tg-u4qj">描述</th>
		  </tr>
		  <tr>
			<td class="tg-tmsl">商户ID</td>
			<td class="tg-tmsl">mchId</td>
			<td class="tg-tmsl">是</td>
			<td class="tg-tmsl">String(30)</td>
			<td class="tg-855q">20001222</td>
			<td class="tg-855q">支付中心分配的商户号</td>
		  </tr>
		  <tr>
			<td class="tg-xggu">商户订单号</td>
			<td class="tg-xggu">mchOrderNo</td>
			<td class="tg-xggu">是</td>
			<td class="tg-xggu">String(30)</td>
			<td class="tg-wo29">20160427210604000490</td>
			<td class="tg-wo29">商户生成的订单号，请保证唯一性</td>
		  </tr>
		  <tr>
			<td class="tg-tmsl">渠道ID</td>
			<td class="tg-tmsl">channelId</td>
			<td class="tg-tmsl">是</td>
			<td class="tg-tmsl">String(24)</td>
			<td class="tg-855q">WX_JSAPI</td>
			<td class="tg-855q">见支付渠道参数</td>
		  </tr>
		  <tr>
			<td class="tg-xggu">币种</td>
			<td class="tg-xggu">currency</td>
			<td class="tg-xggu">是</td>
			<td class="tg-xggu">String(3)</td>
			<td class="tg-wo29">CAD</td>
			<td class="tg-wo29">三位货币代码,加币:CAD</td>
		  </tr>
		  <tr>
			<td class="tg-tmsl">支付金额</td>
			<td class="tg-tmsl">amount</td>
			<td class="tg-tmsl">是</td>
			<td class="tg-tmsl">int</td>
			<td class="tg-855q">100</td>
			<td class="tg-855q">支付金额,单位分</td>
		  </tr>
		  <tr>
			<td class="tg-xggu">客户端IP</td>
			<td class="tg-xggu">clientIp</td>
			<td class="tg-xggu">是</td>
			<td class="tg-xggu">String(32)</td>
			<td class="tg-wo29">210.73.10.148</td>
			<td class="tg-wo29">客户端IP地址</td>
		  </tr>
		  <tr>
			<td class="tg-tmsl">设备</td>
			<td class="tg-tmsl">device</td>
			<td class="tg-tmsl">否</td>
			<td class="tg-tmsl">String(64)</td>
			<td class="tg-855q">WEB</td>
			<td class="tg-855q">终端设备号(门店号或收银设备ID)，注意：PC网页或公众号内支付请传”WEB</td>
		  </tr>
		  <tr>
			<td class="tg-u4qj">支付结果回调URL</td>
			<td class="tg-u4qj">notifyUrl</td>
			<td class="tg-u4qj">是</td>
			<td class="tg-u4qj">String(200)</td>
			<td class="tg-wo29">http://xxx.com/notify.htm</td>
			<td class="tg-wo29">支付结果回调URL</td>
		  </tr>
		  <tr>
			<td class="tg-855q">商品主题</td>
			<td class="tg-855q">subject</td>
			<td class="tg-855q">是</td>
			<td class="tg-855q">String(64)</td>
			<td class="tg-855q">测试商品</td>
			<td class="tg-855q">商品主题</td>
		  </tr>
		  <tr>
			<td class="tg-u4qj">商品描述信息</td>
			<td class="tg-u4qj">body</td>
			<td class="tg-u4qj">是</td>
			<td class="tg-u4qj">String(256)</td>
			<td class="tg-wo29">xxpay测试商品描述</td>
			<td class="tg-wo29">商品描述信息</td>
		  </tr>
		  <tr>
			<td class="tg-855q">扩展参数1</td>
			<td class="tg-855q">param1</td>
			<td class="tg-855q">否</td>
			<td class="tg-855q">String(64)</td>
			<td class="tg-855q"></td>
			<td class="tg-855q">支付中心回调时会原样返回</td>
		  </tr>
		  <tr>
			<td class="tg-wo29">扩展参数2</td>
			<td class="tg-wo29">param2</td>
			<td class="tg-wo29">否</td>
			<td class="tg-wo29">String(64)</td>
			<td class="tg-wo29"></td>
			<td class="tg-wo29">支付中心回调时会原样返回</td>
		  </tr>
		  <tr>
			<td class="tg-855q">附加参数</td>
			<td class="tg-855q">extra</td>
			<td class="tg-855q">是</td>
			<td class="tg-855q">String(512)</td>
			<td class="tg-855q">{“openId”:”o2RvowBf7sOVJf8kJksUEMceaDqo”}</td>
			<td class="tg-855q">特定渠道发起时额外参数,见下面说明</td>
		  </tr>
		  <tr>
			<td class="tg-wo29">签名</td>
			<td class="tg-wo29">sign</td>
			<td class="tg-wo29">是</td>
			<td class="tg-wo29">String(32)</td>
			<td class="tg-wo29">C380BEC2BFD727A4B6845133519F3AD6</td>
			<td class="tg-wo29">签名值，详见签名算法</td>
		  </tr>
		</table>
	<div class="doc-title-box">
			<h2 style="font-weight: bold;">参数示例</h2>
	</div>
	<p><pre>
	params={"amount":1,"mchId":"10000000","mchOrderNo":"9af01329f1ec4c4694631b077a0e8573","subject":"商品支付主题",
	"sign":"F64C43C1487C7C0DA93DA93DD2961FA2","body":"商品支付内容","param1":"","param2":"","clientIp":"127.0.0.1","extra":"
	{\"openId\":\"osirq1MMdgrCw7ohNNV6JhwvDFO8\"}","notifyUrl":"http://ngrok.4jicao.com/goods/payNotify",
	"currency":"CAD","device":"WEB","channelId":"WX_JSAPI"}
	</pre>
	</p>
	<div class="doc-title-box">
			<h2 style="font-weight: bold;">extra参数说明</h2>
	</div>
	<p>1 当请求参数<font style="color:red">channelId = WX_JSAPI</font>（微信公众号支付）时，openId参数必填，对应用户所在微信公众号的openId。</p>
	<p><pre>{"openId":"o2RvowBf7sOVJf8kJksUEMceaDqo","isNeedSubAppId":1}</pre></p>
	<p>2 当请求参数channelId = WX_MWEB（微信H5/APP支付）时，sceneInfo参数必填。参考值：</p>
	<p>◆ IOS移动应用</p>
	<p>{“h5_info”: //h5支付固定传”h5_info” {“type”: “”, //场景类型”app_name”: “”, //应用名”bundle_id”: “” //bundle_id}}</p>
	<p>◆ 安卓移动应用</p>
	<p>{“h5_info”: //h5支付固定传”h5_info” {“type”: “”, //场景类型”app_name”:””,//应用名 “package_name”: “” //包名 }}</p>
	<p>◆ WAP网站应用</p>
	<p>{“h5_info”: //h5支付固定传”h5_info”{“type”: “”, //场景类型 “wap_url”:””,//WAP网站URL地址”wap_name”: “” //WAP 网站名 }}</p>
	<p><pre>{"sceneInfo":"{\"h5_info\": \"h5_info\"  {\"type\": \"\",  \"wap_url\": \"\", \"wap_name\": \"\"}}"}</pre></p>
	
	<p>3 当请求参数<font style="color:red">channelId = WX_NATIVE</font> （微信原生扫码支付）时，productId参数必填，对应业务系统定义的商品ID。</p>
	<p><pre>{"productId":"120989823"}</pre></p>
	<div class="doc-title-box">
			<h2 style="font-weight: bold;">返回结果</h2>
	</div>
	<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;border-color:#ccc;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#f0f0f0;}
.tg .tg-hx12{font-weight:bold;background-color:#efefef;border-color:#c0c0c0;text-align:left;vertical-align:top}
.tg .tg-bx42{font-weight:bold;border-color:#c0c0c0;text-align:left;vertical-align:top}
.tg .tg-855q{background-color:#ffffff;border-color:#c0c0c0;text-align:left;vertical-align:top}
.tg .tg-wo29{border-color:#c0c0c0;text-align:left;vertical-align:top}
</style>
<table class="tg">
  <tr>
    <th class="tg-hx12">字段名</th>
    <th class="tg-bx42">变量名</th>
    <th class="tg-bx42">必填</th>
    <th class="tg-bx42">类型</th>
    <th class="tg-bx42">示例值</th>
    <th class="tg-bx42">描述</th>
  </tr>
  <tr>
    <td class="tg-855q">返回状态码</td>
    <td class="tg-wo29">retCode</td>
    <td class="tg-wo29">是</td>
    <td class="tg-wo29">String(16)</td>
    <td class="tg-wo29">SUCCESS</td>
    <td class="tg-wo29">SUCCESS/FAIL此字段是通信标识，非交易标识，交易是否成功需要查看resCode来判断</td>
  </tr>
  <tr>
    <td class="tg-855q">返回信息</td>
    <td class="tg-wo29">retMsg</td>
    <td class="tg-wo29">否</td>
    <td class="tg-wo29">String(128)</td>
    <td class="tg-wo29">签名失败</td>
    <td class="tg-wo29">返回信息，如非空，为错误原因 签名失败 参数格式校验错误</td>
  </tr>
</table>
<p></p>
	<p>以下字段在retCode为SUCCESS的时候有返回</p>

<table class="tg">
  <tr>
    <th class="tg-hx12">字段名</th>
    <th class="tg-bx42">变量名</th>
    <th class="tg-bx42">必填</th>
    <th class="tg-bx42">类型</th>
    <th class="tg-bx42">示例值</th>
    <th class="tg-bx42">描述</th>
  </tr>
  <tr>
    <td class="tg-855q">业务结果</td>
    <td class="tg-wo29">resCode</td>
    <td class="tg-wo29">是</td>
    <td class="tg-wo29">String(16)</td>
    <td class="tg-wo29">SUCCESS</td>
    <td class="tg-wo29">SUCCESS/FAIL</td>
  </tr>
  <tr>
    <td class="tg-855q">错误代码</td>
    <td class="tg-wo29">errCode</td>
    <td class="tg-wo29">否</td>
    <td class="tg-wo29">String(32)</td>
    <td class="tg-wo29">SYSTEMERROR</td>
    <td class="tg-wo29">错误码</td>
  </tr>
  <tr>
    <td class="tg-0lax">错误代码描述</td>
    <td class="tg-0lax">errCodeDes</td>
    <td class="tg-0lax">否</td>
    <td class="tg-0lax">String(128)</td>
    <td class="tg-0lax">系统错误</td>
    <td class="tg-0lax">结果信息描述</td>
  </tr>
</table>
<p></p>
<p>以下字段在retCode和resCode都为SUCCESS的时候有返回</p>

<table class="tg">
  <tr>
    <th class="tg-hx12">字段名</th>
    <th class="tg-bx42">变量名</th>
    <th class="tg-bx42">必填</th>
    <th class="tg-bx42">类型</th>
    <th class="tg-bx42">示例值</th>
    <th class="tg-bx42">描述</th>
  </tr>
  <tr>
    <td class="tg-855q">支付订单号</td>
    <td class="tg-wo29">payOrderId</td>
    <td class="tg-wo29">是</td>
    <td class="tg-wo29">String(32)</td>
    <td class="tg-wo29">20160427210604000490</td>
    <td class="tg-wo29">支付中心生成的订单号</td>
  </tr>
  <tr>
    <td class="tg-855q">预支付标识</td>
    <td class="tg-wo29">prepayId</td>
    <td class="tg-wo29">否</td>
    <td class="tg-wo29">String(64)</td>
    <td class="tg-wo29">wx201410272009395522657a690389285100</td>
    <td class="tg-wo29">第三方支付公司返回的预支付标识</td>
  </tr>
  <tr>
    <td class="tg-0lax">跳转第三方支付URl</td>
    <td class="tg-0lax">payUrl</td>
    <td class="tg-0lax">否</td>
    <td class="tg-0lax">String(200)</td>
    <td class="tg-0lax">http://url</td>
    <td class="tg-0lax">支付中心生生成跳转第三方支付页面的URL地址</td>
  </tr>
  <tr>
    <td class="tg-0lax">跳转第三方支付方法</td>
    <td class="tg-0lax">payAction</td>
    <td class="tg-0lax">否</td>
    <td class="tg-0lax">String(20)</td>
    <td class="tg-0lax">POST</td>
    <td class="tg-0lax">跳转第三方支付页面要求的方法</td>
  </tr>
  <tr>
    <td class="tg-0lax">跳转第三方支付参数</td>
    <td class="tg-0lax">payParams</td>
    <td class="tg-0lax">否</td>
    <td class="tg-0lax">String(500)</td>
    <td class="tg-0lax"></td>
    <td class="tg-0lax">该字段不参与签名,当payAction=POST时,该参数有值,JSON格式数据,跳转第三方支付页面需要传递的参数</td>
  </tr>
</table>
<p></p>
<p>当请求参数<font style="color:red">channelId=WX_JSAPI</font>（微信公众号支付）时，回JSON格式数据，如：</p>

<p><pre>{
    "sign": "24F5916D6B1AB64918B3BF7250693813", 
    "payOrderId": "P2016081612553098759124940", 
    "retCode": "SUCCESS", 
    "retMsg": "", 
    "resCode": "SUCCESS", 
    "prepayId": "wx201608161255321fc59e085b0578219742",
    "payParams": {
        "appId": "wx0ab67caf7f591834", 
        "timeStamp": 1471323332, 
        "signType": "MD5", 
        "package": "prepay_id=wx201608161255321fc59e085b0578219742", 
        "nonceStr": "08s06nujam43aot3tbl555lavvydl178", 
        "paySign": "21E6BF4984030DBD2DB191F676A47DA2"
    }
}</pre></p>

<table class="tg">
  <tr>
    <th class="tg-hx12">字段名</th>
    <th class="tg-bx42">变量名</th>
    <th class="tg-bx42">必填</th>
    <th class="tg-bx42">类型</th>
    <th class="tg-bx42">示例值</th>
    <th class="tg-bx42">描述</th>
  </tr>
  <tr>
    <td class="tg-0pky">微信签名</td>
    <td class="tg-0pky">paySign</td>
    <td class="tg-0pky">是</td>
    <td class="tg-0pky">String(32)</td>
    <td class="tg-0pky">C380BEC2BFD727A4B6845133519F3AD6</td>
    <td class="tg-0pky">签名,详见签名算法,调取微信支付时用到的签名值</td>
  </tr>
  <tr>
    <td class="tg-855q">应用ID</td>
    <td class="tg-wo29">appId</td>
    <td class="tg-wo29">是</td>
    <td class="tg-wo29">String(32)</td>
    <td class="tg-wo29">wx8888888888888888</td>
    <td class="tg-wo29">微信开放平台审核通过的应用APPID</td>
  </tr>
  <tr>
    <td class="tg-855q">签名算法</td>
    <td class="tg-wo29">signType</td>
    <td class="tg-wo29">是</td>
    <td class="tg-wo29">String(32)</td>
    <td class="tg-wo29">1900000109</td>
    <td class="tg-wo29">签名算法，暂支持MD5</td>
  </tr>
  <tr>
    <td class="tg-0pky">预支付交易会话标识</td>
    <td class="tg-0pky">package</td>
    <td class="tg-0pky">是</td>
    <td class="tg-0pky">String(128)</td>
    <td class="tg-0pky">prepay_id=wx201608161255321fc59e085b0578219742</td>
    <td class="tg-0pky">微信生成的预支付回话标识，用于后续接口调用中使用，该值有效期为2小时,针对H5支付此参数无特殊用途</td>
  </tr>
  <tr>
    <td class="tg-0pky">随机字符串</td>
    <td class="tg-0pky">nonceStr</td>
    <td class="tg-0pky">是</td>
    <td class="tg-0pky">String(32)</td>
    <td class="tg-0pky">5K8264ILTKCH16CQ2502SI8ZNMTM67VS</td>
    <td class="tg-0pky">随机字符串，不长于32位</td>
  </tr>
  <tr>
    <td class="tg-0pky">时间戳</td>
    <td class="tg-0pky">timeStamp</td>
    <td class="tg-0pky">是</td>
    <td class="tg-0pky">String(10)</td>
    <td class="tg-0pky">1412000000</td>
    <td class="tg-0pky">时间戳,10位</td>
  </tr>
</table>
<p></p>
<p>当请求参数<font color="red">channelId=WX_NATIVE</font>（微信公众号扫码支付）时，回JSON格式数据如：</p>

<table class="tg">
  <tr>
    <th class="tg-hx12">字段名</th>
    <th class="tg-bx42">变量名</th>
    <th class="tg-bx42">必填</th>
    <th class="tg-bx42">类型</th>
    <th class="tg-bx42">示例值</th>
    <th class="tg-bx42">描述</th>
  </tr>
  <tr>
    <td class="tg-0pky">二维码链接</td>
    <td class="tg-0pky">codeUrl</td>
    <td class="tg-0pky">否</td>
    <td class="tg-0pky">String(200)</td>
    <td class="tg-0pky">weixin://wxpay/s/Anp43md</td>
    <td class="tg-0pky">可将该参数值生产二维码展示</td>
  </tr>
</table>

     <div class="doc-title-box">
			<h2 style="font-weight: bold;">返回错误</h2>
	</div>
	<p>更多返回错误代码请看<a href="./errorcode.html">这里</a>的错代码描述</p>
	
	</section>
	</div>
	
	
	<a href="#0" class="cd-top js-cd-top">Top</a>
	<script src="js/main.js"></script> 
	<script src="js/jquery-2.1.1.min.js" type="text/javascript"></script>
	<script>
	$('.openNav').click(function () {
	    $('body').toggleClass('navOpen');
	    $('nav').toggleClass('open');
	    $('.wrapper').toggleClass('open');
	    $(this).toggleClass('open');
	});
	</script>
</body>
</html>